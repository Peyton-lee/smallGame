{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\Game.js"],"names":["cc","Class","extends","Component","properties","box","default","type","Prefab","arr","row","col","selectId","clickId","pass","passInfos","_lineNodes","onLoad","_randomArr","length","winSizeW","director","getWinSize","width","showW","background","node","getChildByName","arrs","getSortArrs","_boxWidth","self","i","j","o","point","val","pos","index","x","y","p","instantiate","addChild","anchorX","anchorY","textLabel","setPosition","height","getComponent","Label","string","setScale","setTag","on","Node","EventType","TOUCH_END","event","id","currentTarget","tag","getTag","log","checkAction","push","selectTarget","clickTarget","count","points","_points","slice","checkDoublePoint","checkDoublePass","addPassInfo","findShortPath","selectIdAroundArrs","forEach","item","idx","filter","a","b","shortPath","minLength","nowPoint","lastPoint","Math","abs","drawLine","scheduleOnce","clear","gamePass","destroy","checkGameSuccess","result","every","loadScene","drawNode","DrawNode","Canvas","instance","parent","_sgNode","drawSegment","color","times","toString","indexOf","sort","random0To1","update","dt"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        box: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n\r\n        arr: {\r\n            default: []\r\n        },\r\n\r\n        row: 4, // 行\r\n        col: 4, // 列\r\n        selectId: null,\r\n        clickId: null,\r\n        pass: false,\r\n        passInfos: [],\r\n        _lineNodes: []\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        // 随机图片\r\n        var _randomArr = [1, 2, 3, 4];\r\n        // 获取所有坐标的数组长度\r\n        const length = (this.row + 2) * (this.col + 2);\r\n        // 屏幕宽度\r\n        const winSizeW = cc.director.getWinSize().width;\r\n        const showW = 500;\r\n        const background = this.node.getChildByName(\"Background\");\r\n\r\n        // 获取随机数组\r\n        const arrs = this.getSortArrs(_randomArr, this.row, this.col);\r\n        if (arrs.length === 0) return;\r\n\r\n        // 计算每个盒子宽度\r\n        this._boxWidth = showW / this.col;\r\n        var self = this;\r\n\r\n        // 初始化数据结构\r\n        for (var i = 0; i < this.row + 2; i++) {\r\n            for (var j = 0; j < this.col + 2; j++) {\r\n                var o = {\r\n                    point: [j, i],\r\n                    box: null,\r\n                    val: null,\r\n                    pos: null,\r\n                    index: j + i * (this.row + 2)\r\n                }\r\n                var x = (winSizeW - showW) / 2 + (j - 1) * this._boxWidth;\r\n                var y = 750 - (i - 1) * this._boxWidth;\r\n                o.pos = cc.p(x, y);\r\n\r\n                if (i !== 0 && j !== 0 && i !== this.col + 1 && j !== this.row + 1) {\r\n                    var index = (j - 1) + (i - 1) * this.row;\r\n                    o.val = arrs[index];\r\n                    var box = cc.instantiate(this.box);\r\n                    background.addChild(box);\r\n                    box.anchorX = 0;\r\n                    box.anchorY = 0;\r\n                    var textLabel = box.getChildByName(\"label\");\r\n                    textLabel.setPosition(cc.p(box.width / 2, box.height / 2));\r\n                    textLabel.getComponent(cc.Label).string = o.val;\r\n                    box.setScale(this._boxWidth / box.width);\r\n                    box.setPosition(o.pos);\r\n                    box.setTag(o.index);\r\n                    o.box = box;\r\n\r\n                    // 绑定点击事件\r\n                    box.on(cc.Node.EventType.TOUCH_END, function (event) {\r\n                        var id = +event.currentTarget.getChildByName('label').getComponent(cc.Label).string;\r\n                        var tag = event.currentTarget.getTag();\r\n                        if (!self.arr[tag].box) return;\r\n                        if (!self.selectId) {\r\n                            self.selectId = tag;\r\n                            self.pass = false;\r\n                            cc.log(\"selectId = \", self.arr[tag].val)\r\n                        } else {\r\n                            if (tag === self.selectId) return;\r\n                            self.clickId = tag;\r\n                            self.checkAction(self.arr[self.selectId], self.arr[tag], 0, [])\r\n                        }\r\n                    })\r\n                }\r\n                this.arr.push(o);\r\n            }\r\n        }\r\n    },\r\n\r\n    checkAction: function (selectTarget, clickTarget, count, points) {\r\n        var _points = points.slice();\r\n\r\n        // 两个坐标在同一直线上面 且中间格子都是空的\r\n        if ((selectTarget.point[0] === clickTarget.point[0] || selectTarget.point[1] === clickTarget.point[1]) &&\r\n            this.checkDoublePoint(selectTarget, clickTarget)) {\r\n            if (this.checkDoublePass(this.arr[this.selectId], this.arr[this.clickId])) {\r\n                _points.push(selectTarget);\r\n                _points.push(clickTarget);\r\n                this.addPassInfo(_points);\r\n                count == 0 && this.findShortPath();\r\n            } else {\r\n                if (count === 0) {\r\n                    this.selectId = null;\r\n                }\r\n            }\r\n            return\r\n        }\r\n\r\n        // 最多两个拐点\r\n        if (count === 2) return;\r\n\r\n        _points.push(selectTarget);\r\n        var selectIdAroundArrs = [];\r\n        var self = this;\r\n        this.arr.forEach(function (item, idx) {\r\n            if ((item.point[0] === selectTarget.point[0] && idx !== selectTarget.index && !item.val) ||\r\n                (item.point[1] === selectTarget.point[1] && idx !== selectTarget.index && !item.val)) {\r\n                selectIdAroundArrs.push(item);\r\n            }\r\n        })\r\n\r\n        selectIdAroundArrs = selectIdAroundArrs.filter(function (item) {\r\n            if (self.checkDoublePoint(item, selectTarget)) return item;\r\n        })\r\n\r\n        count++;\r\n        selectIdAroundArrs.forEach(function (item) {\r\n            self.checkAction(item, clickTarget, count, _points)\r\n        })\r\n\r\n        // 遍历完毕 把选择ID复原为Null\r\n        if (count === 1) {\r\n            cc.log(\"所有情况跑完\");\r\n            this.findShortPath();\r\n        }\r\n    },\r\n\r\n    // 判断两个点的值是否一致\r\n    checkDoublePass: function (a, b) {\r\n        return a.val === b.val\r\n    },\r\n\r\n    // 判断两个点之间的格子是否都为null\r\n    checkDoublePoint: function (a, b) {\r\n        if (a.point[0] === b.point[0]) {\r\n            if (a.point[1] > b.point[1]) {\r\n                for (var i = b.point[1] + 1; i < a.point[1]; i++) {\r\n                    var index = a.point[0] + i * (this.row + 2);\r\n                    if (this.arr[index].val) return false;\r\n                }\r\n            } else {\r\n                for (var i = b.point[1] - 1; i > a.point[1]; i--) {\r\n                    var index = a.point[0] + i * (this.row + 2);\r\n                    if (this.arr[index].val) return false;\r\n                }\r\n            }\r\n        } else {\r\n            if (a.point[0] > b.point[0]) {\r\n                for (var i = b.point[0] + 1; i < a.point[0]; i++) {\r\n                    var index = i + b.point[1] * (this.row + 2);\r\n                    if (this.arr[index].val) return false;\r\n                }\r\n            } else {\r\n                for (var i = b.point[0] - 1; i > a.point[0]; i--) {\r\n                    var index = i + b.point[1] * (this.row + 2);\r\n                    if (this.arr[index].val) return false;\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    },\r\n\r\n    // 符合条件\r\n    addPassInfo: function (points) {\r\n        this.passInfos.push(points);\r\n    },\r\n\r\n    // 找到最短的路径\r\n    findShortPath: function () {\r\n        if (this.passInfos.length <= 0) {\r\n            cc.log('没有符合条件!!!');\r\n            this.selectId = null\r\n            return;\r\n        }\r\n        var shortPath = null;\r\n        var minLength = 0;\r\n        this.passInfos.forEach(function (item) {\r\n            var length = 0;\r\n            for (var i = 1; i < item.length; i++) {\r\n                var nowPoint = item[i].point;\r\n                var lastPoint = item[i - 1].point;\r\n                if (nowPoint[0] === lastPoint[0]) {\r\n                    length += Math.abs(nowPoint[1] - lastPoint[1]);\r\n                } else {\r\n                    length += Math.abs(nowPoint[0] - lastPoint[0]);\r\n                }\r\n            }\r\n            if (length < minLength || !minLength) {\r\n                shortPath = item;\r\n                minLength = length;\r\n            }\r\n        })\r\n        for (var i = 0; i < shortPath.length - 1; i++) {\r\n            this.drawLine(shortPath[i], shortPath[i + 1]);\r\n        }\r\n        this.scheduleOnce(function () {\r\n            this._lineNodes.forEach(function (item) {\r\n                item.clear();\r\n            })\r\n            this.gamePass();   \r\n        }, 0.5)\r\n    },\r\n\r\n    // 通过\r\n    gamePass: function () {\r\n        var selectTarget = this.arr[this.selectId];\r\n        var clickTarget = this.arr[this.clickId];\r\n        selectTarget.box.destroy();\r\n        selectTarget.box = null;\r\n        selectTarget.val = null;\r\n        clickTarget.box.destroy();\r\n        clickTarget.box = null;\r\n        clickTarget.val = null;\r\n        this.selectId = null;\r\n        this.pass = true;\r\n        this.passInfos = [];\r\n        this.checkGameSuccess();\r\n    },\r\n\r\n    checkGameSuccess: function () {\r\n        var result = this.arr.every(function (item) {\r\n            return !item.box;\r\n        })\r\n        if (result) {\r\n            cc.log(\"通关\");\r\n            cc.director.loadScene('Pass');\r\n        }\r\n    },\r\n\r\n    drawLine: function (a, b) {\r\n        var drawNode = new cc.DrawNode();\r\n        cc.Canvas.instance.node.parent._sgNode.addChild(drawNode, 100);\r\n        drawNode.drawSegment(cc.p(a.pos.x + this._boxWidth / 2 + 5 , a.pos.y + this._boxWidth / 2), \r\n                             cc.p(b.pos.x + this._boxWidth / 2 + 5, b.pos.y + this._boxWidth / 2), 5, cc.color(265, 1, 0, 255));\r\n//        drawNode.drawSegment(a.pos, b.pos, 5, cc.color(265, 1, 0, 255));\r\n        this._lineNodes.push(drawNode);\r\n    },\r\n\r\n    getSortArrs: function (arrs, row, col) {\r\n        var result = [];\r\n        var times = row * col / arrs.length;\r\n        if (times.toString().indexOf(\".\") >= 0 || times % 2 !== 0) {\r\n            cc.log(\"随机图片的个数不平均\");\r\n            return result;\r\n        }\r\n        for (var i = 0; i < arrs.length; i++) {\r\n            for (var j = 0; j < times; j++) result.push(arrs[i]);\r\n        }\r\n        result.sort(function (a, b) {\r\n            return cc.random0To1() > 0.5 ? 1 : -1;\r\n        })\r\n        return result;\r\n    },\r\n\r\n    // called every frame\r\n    update: function (dt) {\r\n\r\n    },\r\n});\r\n"]}
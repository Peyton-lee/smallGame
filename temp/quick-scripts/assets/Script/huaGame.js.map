{"version":3,"sources":["huaGame.js"],"names":["cc","Class","extends","Component","properties","box","default","type","Prefab","arr","ctor","col","row","onLoad","length","winSizeW","arrs","_getSortArrs","width","i","x","y","Math","floor","point","val","pos","p","instantiate","node","addChild","textLabel","getChildByName","getComponent","Label","string","setScale","setPosition","on","id","event","currentTarget","target","idx","forEach","item","_idx","nears","oldIndex","newIndex","index","_item","runAction","newAddr","oldAddr","moveTo","checkPassGame","log","director","loadScene","result","getSortArrs","push","sort","a","b","random0To1","count","_fn","indexOf","targetIdx","getRandomTarget","nullIdx","getRandom","l","randomIdx"],"mappings":"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","file":"huaGame.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        box: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n\r\n        arr: {\r\n            default: []\r\n        }\r\n    },\r\n\r\n    ctor() {\r\n        // 列\r\n        this.col = 4;\r\n        // 行\r\n        this.row = 4;\r\n    },\r\n\r\n    onLoad() {\r\n        let row = this.row;\r\n        let col = this.col;\r\n        const length = row * col;\r\n        const winSizeW = 500;\r\n\r\n        // 获取随机顺序的数组\r\n        let arrs = this._getSortArrs(length, 2000);\r\n\r\n        // 计算每个盒子宽度\r\n        const width = winSizeW / col;\r\n\r\n        // 初始化数据结构\r\n        for (let i = 0; i < length; i++) {\r\n            let x = (i % col - col / 2 + 0.5) * width;\r\n            let y = 200 - Math.floor(i / col) * width;\r\n            this.arr[i] = {\r\n                point: [i % col, Math.floor(i / col)], // 坐标[x, y]\r\n                val: null, // 值\r\n                box: null, // 实例\r\n                pos: cc.p(x, y) // 相应的坐标对应的位置\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < length - 1; i++) {\r\n            let box = cc.instantiate(this.box);\r\n            this.node.addChild(box);\r\n            let textLabel = box.getChildByName(\"label\");\r\n            textLabel.getComponent(cc.Label).string = arrs[i];\r\n            box.setScale(width / box.width);\r\n\r\n            // 保存到数据结构中\r\n            this.arr[i].val = arrs[i];\r\n            this.arr[i].box = box;\r\n\r\n            box.setPosition(this.arr[i].pos);\r\n\r\n            // 绑定点击事件\r\n            box.on(\"mousedown\", event => {\r\n                let id = +event.currentTarget.getChildByName('label').getComponent(cc.Label).string;\r\n                let target;\r\n                let idx;\r\n                // 遍历找出点击的盒子target\r\n                this.arr.forEach((item, _idx) => {\r\n                    if (id === item.val) {\r\n                        target = item;\r\n                        idx = _idx;\r\n                        return;\r\n                    }\r\n                })\r\n\r\n                // 获取点击盒子的上下左右四个坐标\r\n                let nears = [[target.point[0], target.point[1] - 1],\r\n                                    [target.point[0] + 1, target.point[1]],\r\n                                    [target.point[0], target.point[1] + 1],\r\n                                    [target.point[0] - 1, target.point[1]]],\r\n                    oldIndex = idx,\r\n                    newIndex;\r\n                nears.forEach(_item => {\r\n                    let index = _item[0] + _item[1] * col;\r\n                    if (0 <= _item[0] && _item[0] < col && 0 <= _item[1] && _item[1] < row && !this.arr[index].val) {\r\n                        newIndex = index;\r\n                    }\r\n                })\r\n                // 获取替换的新位置 newIndex >= 0则说明四周存在空的位置 和老位置一起传入\r\n                newIndex >= 0 && this.runAction(oldIndex, newIndex);\r\n            })\r\n\r\n        }\r\n    },\r\n\r\n    runAction(oldIndex, newIndex) {\r\n        let newAddr = this.arr[newIndex];\r\n        let oldAddr = this.arr[oldIndex];\r\n        newAddr.box = oldAddr.box;\r\n        newAddr.val = oldAddr.val;\r\n        newAddr.box.runAction(cc.moveTo(0.1, newAddr.pos));\r\n\r\n        this.arr[oldIndex].val = null;\r\n        this.arr[oldIndex].box = null;\r\n\r\n        // 判断是否结束游戏\r\n        if (this.checkPassGame()) {\r\n            cc.log(\"YOU WIN!! GAME OVER!\");\r\n            cc.director.loadScene(\"Pass\");\r\n        };\r\n\r\n    },\r\n\r\n    checkPassGame() {\r\n        let result = true;\r\n        this.arr.forEach((item, idx) => {\r\n            if (item.val && item.val !== (idx + 1)) {\r\n                result = false;\r\n                return;\r\n            }\r\n        })\r\n        return result;\r\n    },\r\n\r\n    getSortArrs(length) {\r\n        let result = [];\r\n        for (let i = 0; i < length; i++) result.push(i + 1);\r\n        result.sort((a, b) => {\r\n            return cc.random0To1() > 0.5 ? a - b : b - a;\r\n        })\r\n        return result;\r\n    },\r\n\r\n    _getSortArrs(length, count) {\r\n        let result = [];\r\n        for (let i = 0; i < length - 1; i++) result.push(i + 1);\r\n        result.push(null);\r\n\r\n        let _fn = (arrs) => {\r\n            let index = arrs.indexOf(null);\r\n            let targetIdx = null;\r\n            if (index === 0) {\r\n                targetIdx = this.getRandomTarget([index + 1, index + this.col]);\r\n            } else if (index === this.col - 1) {\r\n                targetIdx = this.getRandomTarget([index - 1, index + this.col]);\r\n            } else if (index === length - this.col) {\r\n                targetIdx = this.getRandomTarget([index + 1, index - this.col]);\r\n            } else if (index === length - 1) {\r\n                targetIdx = this.getRandomTarget([index - 1, index - this.col]);\r\n            } else {\r\n                if (index < this.col - 1) {\r\n                    targetIdx = this.getRandomTarget([index + 1, index - 1, index + this.col]);\r\n                } else if ((index + 1) % this.col === 0) {\r\n                    targetIdx = this.getRandomTarget([index - 1, index + this.col, index - this.col]);\r\n                } else if (index > length - this.col) {\r\n                    targetIdx = this.getRandomTarget([index + 1, index - 1, index - this.col]);\r\n                } else if (index % this.col === 0) {\r\n                    targetIdx = this.getRandomTarget([index + 1, index + this.col, index - this.col]);\r\n                } else {\r\n                    targetIdx = this.getRandomTarget([index + 1, index - 1, index + this.col, index - this.col]);\r\n                }\r\n            }\r\n            [arrs[index], arrs[targetIdx]] = [arrs[targetIdx], arrs[index]];\r\n        }\r\n        for (let i = 0; i < 100 * 100 * 100; i++) {\r\n            let nullIdx = result.indexOf(null);\r\n            if (i > count && nullIdx === length - 1) {\r\n                break;\r\n            }\r\n            _fn(result);\r\n        }\r\n        return result;\r\n    },\r\n\r\n    getRandom(l) {\r\n        return 0 | cc.random0To1() * l;\r\n    },\r\n\r\n    getRandomTarget(arrs) {\r\n        let randomIdx = this.getRandom(arrs.length);\r\n        return arrs[randomIdx];\r\n    },\r\n\r\n});\r\n"]}
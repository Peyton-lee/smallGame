{"version":3,"sources":["huaGame.js"],"names":["cc","Class","extends","Component","properties","box","default","type","Prefab","arr","ctor","col","row","onLoad","length","winSizeW","node","width","arrs","_getSortArrs","i","x","y","Math","floor","point","val","pos","p","self","instantiate","addChild","textLabel","getChildByName","getComponent","Label","string","setScale","setPosition","on","event","id","currentTarget","target","idx","forEach","item","_idx","nears","oldIndex","newIndex","_item","index","runAction","newAddr","oldAddr","moveTo","checkPassGame","log","result","getSortArrs","push","sort","a","b","random0To1","count","_fn","indexOf","targetIdx","getRandomTarget","nullIdx","getRandom","l","randomIdx","update","dt"],"mappings":"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","file":"huaGame.js","sourceRoot":"../../../../assets/Script","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        box: {\n            default: null,\n            type: cc.Prefab\n        },\n\n        arr: {\n            default: []\n        }\n    },\n    \n    ctor() {\n        // 列\n        this.col = 4;\n        // 行\n        this.row = 4;\n    },\n\n    // use this for initialization\n    onLoad: function () {\n\n        // 行\n        let row = this.row;\n        // 列\n        let col = this.col;\n        const length = row * col;\n        const winSizeW = this.node.width;\n\n        // 获取随机顺序的数组\n        // const arrs = this.getSortArrs(length - 1);\n        const arrs = this._getSortArrs(length, 2000);\n\n        // 计算每个盒子宽度\n        const width = winSizeW / col;\n\n        // 初始化数据结构\n        for (var i = 0; i < length; i++) {\n            var x = (i % col - col / 2 + 0.5) * width;\n            var y = 200 - Math.floor(i / col) * width;\n            this.arr[i] = {\n                point: [i % col, Math.floor(i / col)], // 坐标[x, y]\n                val: null, // 值\n                box: null, // 实例\n                pos: cc.p(x, y) // 相应的坐标对应的位置\n            }\n        }\n\n\n        var self = this;\n        for (var i = 0; i < length - 1; i++) {\n            var box = cc.instantiate(this.box);\n            this.node.addChild(box);\n            var textLabel = box.getChildByName(\"label\");\n            // 赋值\n            textLabel.getComponent(cc.Label).string = arrs[i];\n            box.setScale(width / box.width);\n\n            // 保存到数据结构中\n            this.arr[i].val = arrs[i];\n            this.arr[i].box = box;\n\n            box.setPosition(this.arr[i].pos);\n\n            // 绑定点击事件\n            box.on(\"mousedown\", function (event) {\n                var id = +event.currentTarget.getChildByName('label').getComponent(cc.Label).string;\n                var target;\n                var idx;\n                // 遍历找出点击的盒子target\n                self.arr.forEach(function (item, _idx) {\n                    if (id === item.val) {\n                        target = item;\n                        idx = _idx;\n                        return;\n                    }\n                })\n\n                // 获取点击盒子的上下左右四个坐标\n                var nears = [[target.point[0], target.point[1] - 1],\n                                    [target.point[0] + 1, target.point[1]],\n                                    [target.point[0], target.point[1] + 1],\n                                    [target.point[0] - 1, target.point[1]]];\n\n                var oldIndex = idx,\n                    newIndex;\n                nears.forEach(function (_item) {\n                    var index = _item[0] + _item[1] * col;\n                    if (0 <= _item[0] && _item[0] < col && 0 <= _item[1] && _item[1] < row && !self.arr[index].val) {\n                        newIndex = index;\n                    }\n                })\n                // 获取替换的新位置 newIndex >= 0则说明四周存在空的位置 和老位置一起传入\n                newIndex >= 0 && self.runAction(oldIndex, newIndex);\n            })\n\n        }\n    },\n\n    runAction: function (oldIndex, newIndex) {\n        var newAddr = this.arr[newIndex];\n        var oldAddr = this.arr[oldIndex];\n        newAddr.box = oldAddr.box;\n        newAddr.val = oldAddr.val;\n        newAddr.box.runAction(cc.moveTo(0.1, newAddr.pos));\n\n        this.arr[oldIndex].val = null;\n        this.arr[oldIndex].box = null;\n\n        // 判断是否结束游戏\n        if (this.checkPassGame()) {\n            cc.log(\"YOU WIN!! GAME OVER!\")\n        };\n\n    },\n\n    checkPassGame: function () {\n        var result = true;\n        this.arr.forEach(function (item, idx) {\n            if (item.val && item.val !== (idx + 1)) {\n                result = false;\n                return;\n            }\n        })\n        return result;\n    },\n\n    getSortArrs: function (length) {\n        var result = [];\n        for (var i = 0; i < length; i++) result.push(i + 1)\n        result.sort(function (a, b) {\n            return cc.random0To1() > 0.5 ? a - b : b - a;\n        })\n        return result;\n    },\n\n    _getSortArrs(length, count) {\n        var result = [];\n        for (var i = 0; i < length - 1; i++) result.push(i + 1);\n        result.push(null);\n\n        var _fn = (arrs) => {\n            var index = arrs.indexOf(null);\n            var targetIdx = null;\n            if (index === 0) {\n                targetIdx = this.getRandomTarget([index + 1, index + this.col]);\n            } else if (index === this.col - 1) {\n                targetIdx = this.getRandomTarget([index - 1, index + this.col]);\n            } else if (index === length - this.col) {\n                targetIdx = this.getRandomTarget([index + 1, index - this.col]);\n            } else if (index === length - 1) {\n                targetIdx = this.getRandomTarget([index - 1, index - this.col]);\n            } else {\n                if (index < this.col - 1) {\n                    targetIdx = this.getRandomTarget([index + 1, index - 1, index + this.col]);\n                } else if ((index + 1) % this.col === 0) {\n                    targetIdx = this.getRandomTarget([index - 1, index + this.col, index - this.col]);\n                } else if (index > length - this.col) {\n                    targetIdx = this.getRandomTarget([index + 1, index - 1, index - this.col]);\n                } else if (index % this.col === 0) {\n                    targetIdx = this.getRandomTarget([index + 1, index + this.col, index - this.col]);\n                } else {\n                    targetIdx = this.getRandomTarget([index + 1, index - 1, index + this.col, index - this.col]);\n                }\n            }\n            [arrs[index], arrs[targetIdx]] = [arrs[targetIdx], arrs[index]];\n        }\n        for (var i = 0; i < 100 * 100 * 100; i++) {\n            var nullIdx = result.indexOf(null);\n            if (i > count && nullIdx === length - 1) {\n                break;\n            }\n            _fn(result);\n        }\n        return result;\n    },\n\n    getRandom: function (l) {\n        return 0 | cc.random0To1() * l;\n    },\n\n    getRandomTarget(arrs) {\n        var randomIdx = this.getRandom(arrs.length);\n        return arrs[randomIdx];\n    },\n\n    // called every frame\n    update: function (dt) {\n\n    },\n});\n"]}